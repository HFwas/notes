# wireshark抓包与四次挥手分析

# 四次挥手流程图

![image-20220227161018901](images/image-20220227161018901.png)

总的流程解释如下：

- 客户端想要关闭连接，发送一个标志位FIN置1的报文，之后客户端进入FIN-WAIT1状态。
- 服务端收到该报文之后，发送一个标志位ACK置1的报文，状态由ESTAB-LISHED转变为CLOSE-WAIT状态，服务端此时还可以继续传输数据。
- 客户端收到服务端的ACK请求后，状态由FIN-WAIT1状态转变为FIN-WAIT2状态。
- 服务端没有数据想要发送，想要关闭连接，发送一个标志位FIN置1而且ACK置1的报文，状态由CLOSE-WAIT状态转变为LAST-ACK状态
- 客户端收到报文之后，发送确认报文，标志文ACK置1，状态由FIN-WAIT2转变为TIME-WAIT状态
- 等待2MSL时间过后，客户端状态由TIME-WAIT状态转变为CLOSED状态。
- 服务端收到客户端ACK报文之后，状态由LASK-ACK状态转变为CLOSED状态。

# wireshark三次挥手

- 第一次挥手：主机向服务器发送FIN+ACK
- 第二次挥手：服务器向主机发送FIN + ACK，wireshark抓包，这里将第二次挥手和第三次挥手合并到一起了。
- 第三次挥手：主机向服务器发送ACK

wireshark抓包图如下：

![image-20220227164051338](images/image-20220227164051338.png)

# 分析三次挥手

## 第一次挥手

- 客户端向服务器发送标志位FIN置1的报文，sequence=299,acknowledge=61298

![image-20220227170755651](images/image-20220227170755651.png)

## 第二次挥手

- 第二次挥手合并了第二次挥手和第三次挥手
- 第二次挥手，服务端发送标志位FIN+ACK置1的报文，
- 确认号是第一次挥手+1=298+1=299，序号是第一次挥手的确认号=61298

![image-20220227170701810](images/image-20220227170701810.png)

## 第三次挥手

- 第三次挥手：发送ACK报文，

![image-20220227170732136](images/image-20220227170732136.png)



