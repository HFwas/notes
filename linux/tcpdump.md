# tcpdump命令

# tcpdump介绍

- 一款sniffer工具，是Linux上的抓包工具，嗅探器
- **tcpdump命令** 是一款抓包，嗅探器工具，它可以打印所有经过网络接口的数据包的头信息，也可以使用`-w`选项将数据包保存到文件中，方便以后分析。

## 基础参数

tcpdump命令支持的参数如下：

```
-a：尝试将网络和广播地址转换成名称；
-c<数据包数目>：收到指定的数据包数目后，就停止进行倾倒操作；
-d：把编译过的数据包编码转换成可阅读的格式，并倾倒到标准输出；
-dd：把编译过的数据包编码转换成C语言的格式，并倾倒到标准输出；
-ddd：把编译过的数据包编码转换成十进制数字的格式，并倾倒到标准输出；
-e：在每列倾倒资料上显示连接层级的文件头；
-f：用数字显示网际网络地址；
-F<表达文件>：指定内含表达方式的文件；
-i<网络界面>：使用指定的网络截面送出数据包；
-l：使用标准输出列的缓冲区；
-n：不把主机的网络地址转换成名字；
-N：不列出域名；
-O：不将数据包编码最佳化；
-p：不让网络界面进入混杂模式；
-q ：快速输出，仅列出少数的传输协议信息；
-r<数据包文件>：从指定的文件读取数据包数据；
-s<数据包大小>：设置每个数据包的大小；
-S：用绝对而非相对数值列出TCP关联数；
-t：在每列倾倒资料上不显示时间戳记；
-tt： 在每列倾倒资料上显示未经格式化的时间戳记；
-T<数据包类型>：强制将表达方式所指定的数据包转译成设置的数据包类型；
-v：详细显示指令执行过程；
-vv：更详细显示指令执行过程；
-x：用十六进制字码列出数据包资料；
-w<数据包文件>：把数据包数据写入指定的文件。
```



## 返回内容指标

第 1 列是为了讨论方便而加的行号，实际的 tcpdump 输出并没有这一列。接下来将用 `#` 号加数字表示第几个包，例如 `#3` 表示第 3 个包。

接下来依次为：

- packet **时间戳**，例如 `02:52:44.513700` 表示抓到这个包的时间是** 02 时 52 分 44 秒 513 毫秒**
- packet **类型**，这里是 `IP` 包
- 源 (SRC) IP 和端口，目的 (DST) IP 和端口
- packet TCP flags，其中
  - `S` 表示 `syn` 包
  - `.` 表示 `ack` 包
  - `F` 表示 `fin` 包
  - `P` 表示 `push` 包（发送正常数据）
- 序列号（seq）
- 应答号（ack）
- 包的 payload 长度
- 包的部分内容（ASCII）



# 三次握手

ybzx-gateway实例抓包信息如下：

```
#1 19:00:45.442052 IP 172.16.34.7.42288 > 172.16.59.9.webcache: Flags [S], seq 305182741, win 64800, options [mss 1440,sackOK,TS val 134902480 ecr 0,nop,wscale 7], length 0
#2 19:00:45.442137 IP 172.16.59.9.webcache > 172.16.34.7.42288: Flags [S.], seq 1599864844, ack 305182742, win 65072, options [mss 1340,sackOK,TS val 858676379 ecr 134902480,nop,wscale 7], length 0
#3 19:00:45.442336 IP 172.16.34.7.42288 > 172.16.59.9.webcache: Flags [.], ack 1, win 507, options [nop,nop,TS val 134902480 ecr 858676379], length 0
#4 19:00:45.442505 IP 172.16.34.7.42288 > 172.16.59.9.webcache: Flags [P.], seq 1:728, ack 1, win 507, options [nop,nop,TS val 134902480 ecr 858676379], length 727: HTTP: GET /taa/loginBySly HTTP/1.1
#5 19:00:45.442529 IP 172.16.59.9.webcache > 172.16.34.7.42288: Flags [.], ack 728, win 503, options [nop,nop,TS val 858676379 ecr 134902480], length 0
^C
```

Watt-dypri实例抓包信息：

```
#1 19:00:45.456428 IP 172.16.59.9.44032 > 172.16.62.7.osm-oev: Flags [S], seq 2274430788, win 64800, options [mss 1440,sackOK,TS val 1428592507 ecr 0,nop,wscale 7], length 0
#2 19:00:45.456594 IP 172.16.62.7.osm-oev > 172.16.59.9.44032: Flags [S.], seq 2932789839, ack 2274430789, win 64260, options [mss 1440,sackOK,TS val 1557313387 ecr 1428592507,nop,wscale 7], length 0
#3 19:00:45.456824 IP 172.16.59.9.44032 > 172.16.62.7.osm-oev: Flags [.], ack 1, win 507, options [nop,nop,TS val 1428592508 ecr 1557313387], length 0
#4 19:00:45.499149 IP 172.16.59.9.44032 > 172.16.62.7.osm-oev: Flags [P.], seq 2857:3638, ack 1, win 507, options [nop,nop,TS val 1428592550 ecr 1557313387], length 781
#5 19:00:45.499194 IP 172.16.62.7.osm-oev > 172.16.59.9.44032: Flags [.], ack 1, win 503, options [nop,nop,TS val 1557313429 ecr 1428592508,nop,nop,sack 1 {2857:3638}], length 0
^C
```

三次握手分析，ybzx-gateway视角分析：

- #1第一次握手，发送seq请求渐露



# 四次挥手